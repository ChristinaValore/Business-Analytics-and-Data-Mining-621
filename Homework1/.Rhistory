library(tidyverse); library(dplyr); library(psych); library(corrplot); library (ggplot2); library(funModeling); library(Hmisc); library (car); library(caTools)
# import data
data <-read.csv("https://raw.githubusercontent.com/ChristinaValore/Business-Analytics-and-Data-Mining-621/master/moneyball-training-data.csv")
# import data
data <-read.csv("https://raw.githubusercontent.com/ChristinaValore/Business-Analytics-and-Data-Mining-621/master/Homework1/moneyball-training-data.csv")
eval <-read.csv("https://raw.githubusercontent.com/ChristinaValore/Business-Analytics-and-Data-Mining-621/master/Homework1/moneyball-evaluation-data.csv")
data <- select(data,-1) # remove index column, which is first column in both datasets
eval <- select(eval,-1)
head (data) # view data for both sets, notice the index column has been removed
head (eval)
set.seed(123)   #  set seed to ensure you always have same random numbers generated
sample <- sample.split(data,SplitRatio = 0.80)
train_1 <- subset(data, sample == TRUE)
test_1 <- subset(data, sample == FALSE)
dim(train_1) # view the dimensions
dim(test_1)
summary(train_1) # univariate view of basic stats
#gives us information about 0's, NA's, variable type, and unique values
df_status(train_1)
train_1 <- subset(train_1, select = -c(TEAM_BASERUN_CS,TEAM_BATTING_HBP)) # drop both variable columns from dataframe
head(train_1) # check columns are removed
View(train_1)
par(mfrow = c(2,2)) #view graphs in 2x2 view
plot(TARGET_WINS ~ TEAM_BATTING_H,train_1) # batting hits
plot(TARGET_WINS ~ TEAM_BATTING_BB,train_1) # batting walks
plot(TARGET_WINS ~ TEAM_PITCHING_H,train_1) # pitching hits allowed
plot(TARGET_WINS ~ TEAM_PITCHING_BB,train_1) # pitching walks allowed
par(mfrow = c(2,2)) #view graphs in 2x2 view
hist(train_1$TEAM_BATTING_H) # hits
hist(train_1$TEAM_BATTING_BB) # walks
hist(train_1$TEAM_PITCHING_H) # hits allowed
hist(train_1$TEAM_PITCHING_BB) #walks allowed
m <- lm(TARGET_WINS ~ TEAM_BATTING_H + TEAM_BATTING_BB - (TEAM_PITCHING_H + TEAM_PITCHING_BB), data=train_1) # model with four variables considered
cook <- cooks.distance(m)
plot(cook, pch="*", cex=2, main="Cook's Distance: Influential Observations") # plot Cook's distance
abline(h = 4*mean(cook, na.rm=T), col="red") # add cutoff line, which is equivalent to 4*mean
text(x=1:length(cook)+1, y=cook, labels=ifelse(cook>4*mean(cook, na.rm=T),names(cook),""), col="red") # add labels for points (rows)
outlierTest(m)
train_1$TEAM_BATTING_SO<-impute(train_1$TEAM_BATTING_SO, median)
train_1$TEAM_BASERUN_SB<-impute(train_1$TEAM_BASERUN_SB, median)
train_1$TEAM_PITCHING_SO<-impute(train_1$TEAM_PITCHING_SO, median)
train_1$TEAM_FIELDING_DP<-impute(train_1$TEAM_FIELDING_DP, median)
# with outliers
train_1$TEAM_BATTING_OB <- train_1$TEAM_BATTING_H + train_1$TEAM_BATTING_BB # create variable team batting on base
train_1$TEAM_PITCHING_A <- train_1$TEAM_PITCHING_H + train_1$TEAM_PITCHING_BB # create variable pitching allows
train_1$BASE_DIFF <- train_1$TEAM_BATTING_OB - train_1$TEAM_PITCHING_A #create variable base diff
# without outliers
train_no$TEAM_BATTING_OB <- train_no$TEAM_BATTING_H + train_no$TEAM_BATTING_BB # create variable team batting on base
train_1$TEAM_BATTING_SO<-impute(train_1$TEAM_BATTING_SO, median)
train_1$TEAM_BASERUN_SB<-impute(train_1$TEAM_BASERUN_SB, median)
train_1$TEAM_PITCHING_SO<-impute(train_1$TEAM_PITCHING_SO, median)
train_1$TEAM_FIELDING_DP<-impute(train_1$TEAM_FIELDING_DP, median)
#removed outliers
train_no<-train_1[-influential, ]
set.seed(123)   #  set seed to ensure you always have same random numbers generated
sample <- sample.split(data,SplitRatio = 0.80)
train_1 <- subset(data, sample == TRUE)
test_1 <- subset(data, sample == FALSE)
dim(train_1) # view the dimensions
dim(test_1)
summary(train_1) # univariate view of basic stats
#gives us information about 0's, NA's, variable type, and unique values
df_status(train_1)
train_1 <- subset(train_1, select = -c(TEAM_BASERUN_CS,TEAM_BATTING_HBP)) # drop both variable columns from dataframe
head(train_1) # check columns are removed
par(mfrow = c(2,2)) #view graphs in 2x2 view
plot(TARGET_WINS ~ TEAM_BATTING_H,train_1) # batting hits
plot(TARGET_WINS ~ TEAM_BATTING_BB,train_1) # batting walks
plot(TARGET_WINS ~ TEAM_PITCHING_H,train_1) # pitching hits allowed
plot(TARGET_WINS ~ TEAM_PITCHING_BB,train_1) # pitching walks allowed
par(mfrow = c(2,2)) #view graphs in 2x2 view
hist(train_1$TEAM_BATTING_H) # hits
hist(train_1$TEAM_BATTING_BB) # walks
hist(train_1$TEAM_PITCHING_H) # hits allowed
hist(train_1$TEAM_PITCHING_BB) #walks allowed
m <- lm(TARGET_WINS ~ TEAM_BATTING_H + TEAM_BATTING_BB - (TEAM_PITCHING_H + TEAM_PITCHING_BB), data=train_1) # model with four variables considered
cook <- cooks.distance(m)
plot(cook, pch="*", cex=2, main="Cook's Distance: Influential Observations") # plot Cook's distance
abline(h = 4*mean(cook, na.rm=T), col="red") # add cutoff line, which is equivalent to 4*mean
text(x=1:length(cook)+1, y=cook, labels=ifelse(cook>4*mean(cook, na.rm=T),names(cook),""), col="red") # add labels for points (rows)
influential <- as.numeric(names(cook)[(cook > 4*mean(cook, na.rm=T))]) # add influential rows
head(train_1[influential, ]) # show rows that match influential numbers
outlierTest(m)
train_1$TEAM_BATTING_SO<-impute(train_1$TEAM_BATTING_SO, median)
train_1$TEAM_BASERUN_SB<-impute(train_1$TEAM_BASERUN_SB, median)
train_1$TEAM_PITCHING_SO<-impute(train_1$TEAM_PITCHING_SO, median)
train_1$TEAM_FIELDING_DP<-impute(train_1$TEAM_FIELDING_DP, median)
#removed outliers
train_no<-train_1[-influential, ]
# with outliers
train_1$TEAM_BATTING_OB <- train_1$TEAM_BATTING_H + train_1$TEAM_BATTING_BB # create variable team batting on base
train_1$TEAM_PITCHING_A <- train_1$TEAM_PITCHING_H + train_1$TEAM_PITCHING_BB # create variable pitching allows
train_1$BASE_DIFF <- train_1$TEAM_BATTING_OB - train_1$TEAM_PITCHING_A #create variable base diff
# without outliers
train_no$TEAM_BATTING_OB <- train_no$TEAM_BATTING_H + train_no$TEAM_BATTING_BB # create variable team batting on base
train_no$TEAM_PITCHING_A <- train_no$TEAM_PITCHING_H + train_no$TEAM_PITCHING_BB # create variable pitching allows
train_no$BASE_DIFF <- train_no$TEAM_BATTING_OB - train_no$TEAM_PITCHING_A # create variable base diff
par(mfrow = c(1,2)) #view graphs in 2x2 view
plot(train_1$BASE_DIFF,train_1$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference"))
plot(train_no$BASE_DIFF,train_no$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference"))
par(mfrow = c(1,2)) #view graphs in 2x2 view
plot(train_1$BASE_DIFF,train_1$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference"))
plot(train_no$BASE_DIFF,train_no$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference (no outliers"))
par(mfrow = c(1,2)) #view graphs in 2x2 view
plot(train_1$BASE_DIFF,train_1$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference"))
plot(train_no$BASE_DIFF,train_no$TARGET_WINS, xlab = "On plate difference", ylab = "Wins", title("Wins vs. On plate difference (no)"))
model_1 = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_BATTING_HR + TEAM_PITCHING_A + TEAM_FIELDING_E + TEAM_FIELDING_DP, data = train_1)
summary(model_1)
model_1_no = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_BATTING_HR + TEAM_PITCHING_A + TEAM_FIELDING_E + TEAM_FIELDING_DP, data = train_no)
summary(model_1_no)
model_2 = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_FIELDING_E + TEAM_FIELDING_DP, data = train_1)
summary(model_2)
model_2_no = lm(TARGET_WINS ~ TEAM_BATTING_OB+ TEAM_FIELDING_E + TEAM_FIELDING_DP, data = train_no)
summary(model_2_no)
model_3 = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_FIELDING_E, data = train_1)
summary(model_3)
model_3_no = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_FIELDING_E, data = train_no)
summary(model_3_no)
model_4 = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_FIELDING_E +TEAM_BASERUN_SB, data = train_1)
summary(model_4)
model_4_no = lm(TARGET_WINS ~ TEAM_BATTING_OB + TEAM_FIELDING_E +TEAM_BASERUN_SB, data = train_no)
summary(model_4_no)
#remove same columns from train_1
test_1 <- subset(test_1, select=-c(TEAM_BASERUN_CS,TEAM_BATTING_HBP))
#missing values for test
test_1$TEAM_BATTING_SO<-impute(test_1$TEAM_BATTING_SO, median)
test_1$TEAM_BASERUN_SB<-impute(test_1$TEAM_BASERUN_SB, median)
test_1$TEAM_PITCHING_SO<-impute(test_1$TEAM_PITCHING_SO, median)
test_1$TEAM_FIELDING_DP<-impute(test_1$TEAM_FIELDING_DP, median)
#add for test_1
test_1$TEAM_BATTING_OB <- test_1$TEAM_BATTING_H + test_1$TEAM_BATTING_BB # create variable team batting on base
test_1$TEAM_PITCHING_A <- test_1$TEAM_PITCHING_H + test_1$TEAM_PITCHING_BB # create variable pitching allows
test_1$BASE_DIFF <- test_1$TEAM_BATTING_OB - test_1$TEAM_PITCHING_A
wins = test_1$TARGET_WINS
as.matrix(c(mean((wins - predict.lm(model_1, newdata = test_1))^2),
mean((wins - predict.lm(model_2, newdata = test_1))^2),
mean((wins - predict.lm(model_3, newdata = test_1))^2),
mean((wins - predict.lm(model_4, newdata = test_1))^2))
)
summary(model_1)
summary(model_2)
summary(model_3)
summary(model_4)
plot(model_4)
#residuals vs fitted suggests constant variance
#in normqq plot there appears to be some skewness at the right end
#scale-location shows homoscedasticity
#residuals vs leverage shows influential points
par(mfrow = c(2,2))
plot(model_4)
#residuals vs fitted suggests constant variance
#in normqq plot there appears to be some skewness at the right end
#scale-location shows homoscedasticity
#residuals vs leverage shows influential points
